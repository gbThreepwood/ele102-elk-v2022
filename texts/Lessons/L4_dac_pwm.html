<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Analog output (digital to analog conversion) &mdash; ELE102 Microcontroller course v1.1.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     'v1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="ELE102 Microcontroller course v1.1.0 documentation" href="../../index.html" />
    <link rel="next" title="Additional material for lesson 1" href="../Lessons-additional/L1_additional.html" />
    <link rel="prev" title="Digital I/O, and timing" href="L3_digital_io_and_timing.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">ELE102 Microcontroller course v1.1.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Analog output (digital to analog conversion)</a><ul>
<li><a class="reference internal" href="#digital-to-analog-converter">Digital to analog converter</a></li>
<li><a class="reference internal" href="#pulse-width-modulation-pwm">Pulse Width Modulation (PWM)</a><ul>
<li><a class="reference internal" href="#analog-output-by-pwm">Analog output by PWM</a></li>
<li><a class="reference internal" href="#operation-of-a-pulse-width-modulator">Operation of a pulse width modulator</a></li>
<li><a class="reference internal" href="#mapping-signals-with-different-dynamic-range">Mapping signals with different dynamic range</a></li>
<li><a class="reference internal" href="#exercise-adjusting-the-light-intensity-of-led">Exercise: Adjusting the light intensity of LED</a></li>
<li><a class="reference internal" href="#exercise-continuously-adjusting-the-light-intensity-of-led">Exercise: Continuously adjusting the light intensity of LED</a></li>
<li><a class="reference internal" href="#exercise-adjusting-the-light-intensity-of-multiple-leds">Exercise: Adjusting the light intensity of multiple LEDs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions">Functions</a><ul>
<li><a class="reference internal" href="#no-input-no-output">No input no output</a></li>
<li><a class="reference internal" href="#no-output-but-with-input">No output but with input</a></li>
<li><a class="reference internal" href="#integer-return">Integer return</a></li>
<li><a class="reference internal" href="#exercise-abstracting-away-your-hardware">Exercise: Abstracting away your hardware</a></li>
<li><a class="reference internal" href="#exercise-pythagoras">Exercise: Pythagoras</a></li>
<li><a class="reference internal" href="#function-for-debounce-of-multiple-push-buttons">Function for debounce of multiple push buttons</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loops">Loops</a><ul>
<li><a class="reference internal" href="#while-loops">While loops</a></li>
<li><a class="reference internal" href="#for-loops">For loops</a></li>
<li><a class="reference internal" href="#do-while-loops">Do while loops</a></li>
<li><a class="reference internal" href="#loop-example">Loop example</a></li>
<li><a class="reference internal" href="#exercise-blink-a-led-seven-times">Exercise: Blink a LED seven times</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="L3_digital_io_and_timing.html" title="Digital I/O, and timing" accesskey="P">previous </a></li>
              <li><a href="../Lessons-additional/L1_additional.html" title="Additional material for lesson 1" accesskey="N">next </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<h3><a href="../../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Lessons:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="L0_Introduction_elk.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_hardware_preparations.html">Software and hardware preparations</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1a_UC_intro.html">Lesson 1a: What is a Microcontroller</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1b_Arduino_intro.html">Lesson 1b: Introduction to Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_digital_io.html">Lesson 2: Digital I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="L3_digital_io_and_timing.html">Lesson 3: Use of digital I/O and timing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lesson 4: Analog output (PWM)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#digital-to-analog-converter">Digital to analog converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pulse-width-modulation-pwm">Pulse Width Modulation (PWM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#analog-output-by-pwm">Analog output by PWM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-of-a-pulse-width-modulator">Operation of a pulse width modulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapping-signals-with-different-dynamic-range">Mapping signals with different dynamic range</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-adjusting-the-light-intensity-of-led">Exercise: Adjusting the light intensity of LED</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-continuously-adjusting-the-light-intensity-of-led">Exercise: Continuously adjusting the light intensity of LED</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-adjusting-the-light-intensity-of-multiple-leds">Exercise: Adjusting the light intensity of multiple LEDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#no-input-no-output">No input no output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#no-output-but-with-input">No output but with input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integer-return">Integer return</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-abstracting-away-your-hardware">Exercise: Abstracting away your hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-pythagoras">Exercise: Pythagoras</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function-for-debounce-of-multiple-push-buttons">Function for debounce of multiple push buttons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loops">Loops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#while-loops">While loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-loops">For loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#do-while-loops">Do while loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loop-example">Loop example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-blink-a-led-seven-times">Exercise: Blink a LED seven times</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional material:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L1_additional.html">Additional material lesson 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L2_additional.html">Additional material lesson 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L3_additional.html">Additional material lesson 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L4_additional.html">Additional material lesson 4</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/Additionals.html">Mix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/ir_communication.html">Infrared remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/RC_car.html">Cool Project: RC Car (Bluetooth or Joystick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/Robotarm.html">Cool Project: Simple Robot Arm (Bluetooth or Joystick)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/low_power_operation.html">Low power operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/stacks_queues_lists.html">Lesson Stacks, Queues, Lists</a></li>
</ul>

<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="L3_digital_io_and_timing.html"
                          title="previous chapter">Digital I/O, and timing</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../Lessons-additional/L1_additional.html"
                          title="next chapter">Additional material for lesson 1</a></p>
  </div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="analog-output-digital-to-analog-conversion">
<span id="dac-pwm"></span><h1>Analog output (digital to analog conversion)<a class="headerlink" href="#analog-output-digital-to-analog-conversion" title="Permalink to this headline">¶</a></h1>
<div class="section" id="digital-to-analog-converter">
<h2>Digital to analog converter<a class="headerlink" href="#digital-to-analog-converter" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Add graph of discrete samples, and DAC output.</p>
</div>
<p>A digital to analog converter is a device which converts a digital representation of a signal in to a real physical signal, typically a voltage. The digital representation is just a number, which has discrete steps in it’s value, while the analog signal is capable of continuous variation <a class="footnote-reference brackets" href="#f10" id="id2">1</a>.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f10"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>In reality the digital representation is also analog. It is analog in the sense that the computer exists in a analog universe, but it does not matter if the computer uses 0 V and 5 V, 0 V and 3.3 V, or some other voltage levels to represent the binary values. Either way the interpretation of the digital value should be the same.</p>
</dd>
</dl>
</div>
<div class="section" id="pulse-width-modulation-pwm">
<h2>Pulse Width Modulation (PWM)<a class="headerlink" href="#pulse-width-modulation-pwm" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Graph over PWM curve</p>
</div>
<p>What is Modulation?</p>
<p>What is a pulse?</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Blackboard explanation.</p>
</div>
<div class="section" id="analog-output-by-pwm">
<h3>Analog output by PWM<a class="headerlink" href="#analog-output-by-pwm" title="Permalink to this headline">¶</a></h3>
<p>As already discussed, analog output from a microcontroller (or any digital system) is performed by means of a Digital to Analog Converter (DAC). The Atmega328p of the Arduino UNO does not have a dedicated DAC built in to the device, but it has another feature which allows us to perform a crude digital to analog conversion <a class="footnote-reference brackets" href="#f11" id="id4">2</a>. The feature is known as pulse width modulation, and basically means that we are switching one of the digital outputs on and off quickly, but with variation in the durations the output stays high and low. This allows us to control the average output voltage. By using some external components for filtering, this pulsating voltage can be converted to a steady voltage with a value corresponding to the average of the PWM signal.</p>
<p>You may wonder why pulse width modulation is a special feature in the microcontroller, only available on some pins. As you know from the previous lessons, any GPIO pin is capable of switching between the two voltage states representing <em>high</em>, and <em>low</em> (5 V, and 0 V on the Arduino UNO). It is indeed possible to generate PWM on any GPIO, and there are examples on situations where switching a generic GPIO in this way is desirable. The problem is that this switching is controlled by the software, taking up a certain amount of the available CPU time. If the switching frequency is supposed to be high, it will leave little room for the microcontroller to be working on other tasks besides the PWM. Additionally having multiple PWM outputs in this way increases the load even further. For this reason dedicated hardware support for PWM in included on some pins of the microcontroller. You simply configure the PWM, and the output will be running continuously with your settings, until it is changed from software. The reason only some pins have PWM is simply to reduce cost, there are other more powerful microcontrollers which support PWM on any pin.</p>
<p>Alternatively if you need “real” analog output you may use an external chip, that the Arduino may control by a digital bus such as I2C.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f11"><span class="brackets"><a class="fn-backref" href="#id4">2</a></span></dt>
<dd><p>In reality the PWM DAC does not necessarily have to be considered a crude way to convert from digital to analog. It all depends on the switching frequency, and the analog filtering which is applied.</p>
</dd>
</dl>
</div>
<div class="section" id="operation-of-a-pulse-width-modulator">
<h3>Operation of a pulse width modulator<a class="headerlink" href="#operation-of-a-pulse-width-modulator" title="Permalink to this headline">¶</a></h3>
<p>In this section we will cover the basics of how the PWM-outputs on the Atmega328p are operating.</p>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>Figure from datasheet</p>
</div>
<p>The Arduino function associated with analog output signals that we will be using in this tutorial are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.arduino.cc/reference/en/language/functions/analog-io/analogwrite/">analogWrite()</a></p></li>
</ul>
<p>The function in the Arduino library used to output a PWM signal is <code class="code docutils literal notranslate"><span class="pre">analogWrite(pin,</span> <span class="pre">value)</span></code>. <em>pin</em> is the pin number used for the PWM output. <em>value</em> is a number proportional to the duty cycle of the signal. When value = 0, the signal is always off. When value = 255, the signal is always on. On the Arduino UNO, the PWM function is available on pins 3, 5, 6, 9, 10, and 11. The frequency of the PWM signal on most pins is approximately 490 Hz. On the Uno and similar boards, pins 5 and 6 have a frequency of approximately 980 Hz. Pins 3 and 11 on the Arduino Leonardo also run at 980 Hz. The Arduino library does not support changing this frequency, but it is possible to do so by directly manipulating the registers of the Atmega328p hardware.</p>
</div>
<div class="section" id="mapping-signals-with-different-dynamic-range">
<h3>Mapping signals with different dynamic range<a class="headerlink" href="#mapping-signals-with-different-dynamic-range" title="Permalink to this headline">¶</a></h3>
<p>Suppose your input signal has a range of 0 - 1023, and you need to drive the PWM which expects a value of 0 - 255. The larger dynamic range input signal needs to be <em>mapped</em> to the low dynamic range parameter of the PWM control signal. In order to achieve this one may use the following generic equation, where <em>x</em> is the input, and <em>y</em> is the output signal:</p>
<div class="math notranslate nohighlight">
\[y = \frac{(x - x_{min}) \cdot (y_{max} - y_{min})}{(x_{max} - x_{min})} + y_{min}\]</div>
<p>For our example, this yields:</p>
<div class="math notranslate nohighlight">
\[y = \frac{(x - 0) \cdot (255 - 0)}{(1023 - 0)} + 0 = x \cdot \frac{255}{1023}\]</div>
<p>The Arduino library has a built in function for the mapping of one signal over to another with a different range. But as you have seen from the above example it might be just as easy to do the calculations on your own. Anyway the function definition in the library is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">long</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">in_min</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">in_max</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">out_min</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">out_max</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">in_min</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">out_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">out_min</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">in_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">in_min</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">out_min</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Hence to map an analog input value, which ranges from 0 to 1023 to a PWM output signal, which ranges from 0 - 255, you can use the <code class="code docutils literal notranslate"><span class="pre">map(value,</span> <span class="pre">0,</span> <span class="pre">1023,</span> <span class="pre">0,</span> <span class="pre">255)</span></code> function. This function has five parameters, one is the variable in which the analog value is stored, while the others are 0, 1023, 0 and 255 respectively.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">long</span></code> variable type used it the function has the same size as <code class="code docutils literal notranslate"><span class="pre">int32_t</span></code>.</p>
</div>
<div class="section" id="exercise-adjusting-the-light-intensity-of-led">
<h3>Exercise: Adjusting the light intensity of LED<a class="headerlink" href="#exercise-adjusting-the-light-intensity-of-led" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="../../_images/single_led_bb.png"><img alt="Single external LED" class="align-center" src="../../_images/single_led_bb.png" style="width: 438.0px; height: 610.5px;" /></a>
<p>In this exercise we will adjust the light intensity of a single LED by means of PWM.</p>
<ol class="arabic simple">
<li><p>Connect a LED in accordance with the figure. If you already have a LED connected, you only have to make sure it is connected to one of the pins which support PWM.</p></li>
<li><p>Write a simple test program where <code class="code docutils literal notranslate"><span class="pre">analogWrite(pin,</span> <span class="pre">value)</span></code> is used to control the pin connected to the LED. Try with various values for the <code class="code docutils literal notranslate"><span class="pre">value</span></code>, e.g. 64, 128, 255.</p></li>
<li><p>Extend the program so that a digital input connected to a push button changes the intensity of the LED. When you push the button it should change the duty-cycle from 64, to 128.</p></li>
</ol>
</div>
<div class="section" id="exercise-continuously-adjusting-the-light-intensity-of-led">
<h3>Exercise: Continuously adjusting the light intensity of LED<a class="headerlink" href="#exercise-continuously-adjusting-the-light-intensity-of-led" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Write a program which increase the light intensity by pushing button 1, and decrease by pushing button 2.</p></li>
</ol>
</div>
<div class="section" id="exercise-adjusting-the-light-intensity-of-multiple-leds">
<h3>Exercise: Adjusting the light intensity of multiple LEDs<a class="headerlink" href="#exercise-adjusting-the-light-intensity-of-multiple-leds" title="Permalink to this headline">¶</a></h3>
<p>In this example we will be adjusting the light intensity of two LED’s connected to pin 5, and 6. A push button on pin 10 is used to step through various intensity levels.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/digital_input_and_output_bb.png"><img alt="../../_images/digital_input_and_output_bb.png" src="../../_images/digital_input_and_output_bb.png" style="width: 477.0px; height: 660.0px;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Logic Analyzer, or scope demonstration.</p>
</div>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>Add solution after the lecture</p>
</div>
<ol class="arabic simple">
<li><p>Connect the push button, and the two LEDs in accordance with the schematic.</p></li>
<li><p>Write a program which toggles evenly between 5 levels of light intensity (from 0 to 255) by the pushing of the button. Both LEDs should have the same intensity, starting at 0, and ending at 255.</p></li>
<li><p>Extend the program such that after reaching maximum intensity, another push of the button resets the intensity back to 0.</p></li>
<li><p>Extend the program such that while one LED is stepping down, the other is stepping up in intensity. After reaching maximum (or minimum) intensity, the direction should change.</p></li>
</ol>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id7">3</a></span></dt>
<dd><p>Arduino Cookbook by Michael Margolis Chapter 2.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p><em>Functions</em> are used to organize the actions performed by your software into functional blocks. Functions package functionality into well-defined <em>inputs</em> (information given to a function) and <em>outputs</em> (information provided by a function) that make it easier to structure, maintain, and reuse your code. You are already familiar with the two functions that are in every Arduino firmware: <code class="code docutils literal notranslate"><span class="pre">setup</span></code> and <code class="code docutils literal notranslate"><span class="pre">loop</span></code>. You create a function by declaring its return type (the information it provides), its name, and any optional parameters (values that the function will receive when it is called). <a class="footnote-reference brackets" href="#f2" id="id7">3</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The terms functions and methods are used to refer to well-defined blocks of code that can be called as a single entity by other parts of a program. The C language refers to these as functions. Object-oriented languages such as C++ that expose functionality through classes tend to use the term method. Arduino uses a mix of styles (the example sketches tend to use C-like style, libraries tend to be written to expose C++ class methods). We will normally use the term <em>function</em>, unless the code is exposed through a class. Don’t worry; if that distinction is not clear to you, treat both terms as the same.</p>
</div>
<p>A parameter is sometimes referred to as an argument in some documentation. For practical purposes, you can treat these terms as meaning the same thing. We will use them interchangeably here.</p>
<div class="section" id="no-input-no-output">
<h3>No input no output<a class="headerlink" href="#no-input-no-output" title="Permalink to this headline">¶</a></h3>
<p>In mathematic a function which takes no input, and provide no output makes no sense. In our software however it does make sense because here a function can have side effects. I.e. it can affect something outside of the function call, such as a digital output, a memory location, or it can simply block forcing us to wait for a while. E.g. a function <code class="code docutils literal notranslate"><span class="pre">delay_one_second()</span></code> could be defined which block for one second (though we would not recommend this, or consider it a good practice).</p>
<p>Actually, even if the function takes no parameters, the function call can be considered the simples possible parameter. The call will happen on a specific instant in your code, and this will affect the instant at which the side effects of the function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ledPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">my_func_on</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">my_func_off</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">my_func_on</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">my_func_off</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="no-output-but-with-input">
<h3>No output but with input<a class="headerlink" href="#no-output-but-with-input" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ledPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">ledState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">my_func</span><span class="p">(</span><span class="n">ledState</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ledState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">ledState</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">my_func</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">state</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">my_nosense_func</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="integer-return">
<h3>Integer return<a class="headerlink" href="#integer-return" title="Permalink to this headline">¶</a></h3>
<p>The following code demonstrate how to define a function which is capable of returning a single integer. It is a silly function which always returns 5, regardless of what value you try to pass as a parameter.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">my_meaningful_func</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The basic functions in C are only able to return a single value. You can return multiple values but it is a bit more advanced topic which require utilizing some features on the language which we have not discussed so far.</p>
</div>
<div class="section" id="exercise-abstracting-away-your-hardware">
<h3>Exercise: Abstracting away your hardware<a class="headerlink" href="#exercise-abstracting-away-your-hardware" title="Permalink to this headline">¶</a></h3>
<p>In order to make it easy to reuse your code on multiple platforms, it can be useful to use functions to abstract away you hardware. E.g. instead of running <code class="code docutils literal notranslate"><span class="pre">digitalWrite(red_led,</span> <span class="pre">HIGH)</span></code> when you need to change a digital output for a LED, it is better to define a separate function <code class="code docutils literal notranslate"><span class="pre">red_led_on();</span></code> which perform this operation.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">red_led_on</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">red_led</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you move to a different platform instead of Arduino, it is likely that the function which modify a digital output will be different. E.g. on the STM32 HAL the function is <code class="code docutils literal notranslate"><span class="pre">HAL_GPIO_WritePin(GPIOA,</span> <span class="pre">RED_LED_PIN,</span> <span class="pre">GPIO_PIN_SET);</span></code>. For a large software project you could easily be modifying the state of the LED in multiple areas of your code. Thus there will me many places you would have to change. If you have abstracted the operation by a function however, the only place you have to change your code is inside this special function.</p>
<ol class="arabic simple">
<li><p>Start by copying the switch debounce example discussed previously in to a new project.</p></li>
<li><p>Modify the program so that it toggles the state of a LED when a button is pushed.</p></li>
<li><p>Modify the program so that it toggles the state of a LED by use of two functions, <code class="code docutils literal notranslate"><span class="pre">red_led_on()</span></code>, and <code class="code docutils literal notranslate"><span class="pre">red_led_off()</span></code>. I.e. one function which turns on the LED, and another which turns it off.</p></li>
<li><p>Add another function <code class="code docutils literal notranslate"><span class="pre">red_led_toggle()</span></code> which toggles the state of the LED. Update your software to use this new function.</p></li>
</ol>
</div>
<div class="section" id="exercise-pythagoras">
<h3>Exercise: Pythagoras<a class="headerlink" href="#exercise-pythagoras" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Declare, and define a function which computes the hypotenuse of a right angled rectangle given the length of the two other sides. The function should take two arguments of type integer, and return a single integer result.</p></li>
<li><p>Test the function with some data, and print the result to the serial port.</p></li>
</ol>
</div>
<div class="section" id="function-for-debounce-of-multiple-push-buttons">
<h3>Function for debounce of multiple push buttons<a class="headerlink" href="#function-for-debounce-of-multiple-push-buttons" title="Permalink to this headline">¶</a></h3>
<p>The previously discussed method for software switch debounce is a good candidate for placement in a function. Switch debounce is almost always needed when using mechanical push buttons on digital inputs, and it makes sense to have the code available for easy reuse. Additionally if designed properly a single function can be used for debounce of multiple digital inputs.</p>
<p>The following source code listing illustrates how to perform multiple switch debounce in a slightly more elegant way than simply duplicating the single switch debounce code for each new button. Additionally the example illustrates the use of functions for checking for button events.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to improve this example by using some advanced features of the C language, i.e. it does not need all the repetitive code in all the btnx_press_event() functions. This will have to wait for a future lecture however.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Switch debouncing will be needed in almost every application which utilize push buttons. Hence you should settle upon some code which is easy to reuse for all you debouncing needs, and simply copy it in to the projects which need it.</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  4</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  5</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="c1">// Check the button states with a 10 ms time interval</span>
<span class="linenos">  8</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn_sample_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">prev_time_stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 13</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="cm">/**</span>
<span class="linenos"> 16</span><span class="cm"> * @brief Debounce up to 8 digital inputs</span>
<span class="linenos"> 17</span><span class="cm"> *</span>
<span class="linenos"> 18</span><span class="cm"> * This function must be called at regular intervals</span>
<span class="linenos"> 19</span><span class="cm"> *  </span>
<span class="linenos"> 20</span><span class="cm"> * @param current_state </span>
<span class="linenos"> 21</span><span class="cm"> * @return uint8_t </span>
<span class="linenos"> 22</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos"> 23</span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">switch_debounce</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">current_state</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">asserted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 26</span><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">prev_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="w">    </span><span class="c1">// Set the bits for the pressed buttons</span>
<span class="linenos"> 31</span><span class="w">    </span><span class="n">asserted</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="c1">// Clear the bits for the released buttons</span>
<span class="linenos"> 34</span><span class="w">    </span><span class="n">asserted</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="w">    </span><span class="c1">// Update the history</span>
<span class="linenos"> 37</span><span class="w">    </span><span class="n">prev_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_state</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span><span class="w">    </span><span class="c1">// Exclusive or between previous and current assertion</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="c1">// Only the bits which are different will stay high</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 45</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 46</span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">btn1_press_event</span><span class="p">(){</span><span class="w"></span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x01</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x01</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 51</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 52</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 56</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">btn1_release_event</span><span class="p">(){</span><span class="w"></span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x01</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x01</span><span class="p">)){</span><span class="w"></span>
<span class="linenos"> 63</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 64</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 65</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 68</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">btn2_press_event</span><span class="p">(){</span><span class="w"></span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x02</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x02</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 75</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 76</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 77</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 80</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">btn3_press_event</span><span class="p">(){</span><span class="w"></span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x04</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x04</span><span class="p">){</span><span class="w"></span>
<span class="linenos"> 87</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 88</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 92</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 95</span><span class="w">  </span><span class="n">pinMode</span><span class="p">(</span><span class="n">btn1</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">pinMode</span><span class="p">(</span><span class="n">btn2</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 99</span><span class="p">}</span><span class="w"></span>
<span class="linenos">100</span>
<span class="linenos">101</span><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">102</span><span class="w"> </span>
<span class="linenos">103</span><span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">current_time_stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">millis</span><span class="p">();</span><span class="w"></span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="w">  </span><span class="c1">// Limit how often the button state is checked</span>
<span class="linenos">106</span><span class="w">  </span><span class="c1">// This method is not good if it is important to detect the first edge of the button change</span>
<span class="linenos">107</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">current_time_stamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev_time_stamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">btn_sample_interval</span><span class="p">){</span><span class="w"></span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn1_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">btn1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">110</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn2_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">btn2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">111</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">btn3_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">btn3</span><span class="p">);</span><span class="w"></span>
<span class="linenos">112</span><span class="w">    </span>
<span class="linenos">113</span><span class="w">    </span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">switch_debounce</span><span class="p">(</span><span class="n">btn1_state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">btn2_state</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">btn3_state</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="linenos">114</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn1_press_event</span><span class="p">()){</span><span class="w"></span>
<span class="linenos">116</span><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;btn1 press event.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">117</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">118</span>
<span class="linenos">119</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn1_release_event</span><span class="p">()){</span><span class="w"></span>
<span class="linenos">120</span><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;btn1 release event.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">121</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">122</span>
<span class="linenos">123</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn2_press_event</span><span class="p">()){</span><span class="w"></span>
<span class="linenos">124</span><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;btn2 press event.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">125</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">126</span>
<span class="linenos">127</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">btn3_press_event</span><span class="p">()){</span><span class="w"></span>
<span class="linenos">128</span><span class="w">      </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;btn3 press event.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">129</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">130</span>
<span class="linenos">131</span><span class="w">    </span><span class="n">prev_time_stamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_time_stamp</span><span class="p">;</span><span class="w"></span>
<span class="linenos">132</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">133</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The example is built around the following function, which probably needs some explaining:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">switch_debounce</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">current_state</span><span class="p">){</span><span class="w"></span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">asserted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">prev_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Set the bits for the pressed buttons</span>
<span class="w">    </span><span class="n">asserted</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Clear the bits for the released buttons</span>
<span class="w">    </span><span class="n">asserted</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Update the history</span>
<span class="w">    </span><span class="n">prev_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_state</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Exclusive or between previous and current assertion</span>
<span class="w">    </span><span class="c1">// Only the bits which are different will stay high</span>
<span class="w">    </span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function is called periodically by:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">btn_asserted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">switch_debounce</span><span class="p">(</span><span class="n">btn1_state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">btn2_state</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">btn3_state</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>The function takes one <code class="code docutils literal notranslate"><span class="pre">uint8_t</span></code> as parameter. Each bit in this byte corresponds to a digital input which we want to debounce. In the function call the parameter is formed of the three bits which indicate the state of the three push buttons. We are using the bit left shift operator <code class="code docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> to shift the bits of the button 2, and button 3 state, one, and two places respectively. The bitwise or operator <code class="code docutils literal notranslate"><span class="pre">|</span></code> is then used to merge them in to a single byte.</p>
<p>After declaring some variables, the first line of interest is the following:</p>
<p>The purpose it to store the previously asserted button states. I.e. the <code class="code docutils literal notranslate"><span class="pre">asserted</span></code> variable holds the state (which is considered stable) of up to 8 push buttons, and before we update it, we first store the previous value.</p>
<p>The next statement is the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">asserted</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The purpose is to compare the previous state of the push buttons to the current state. If the states are equal, and high, we set the corresponding bits in the <code class="code docutils literal notranslate"><span class="pre">asserted</span></code> variable.</p>
<p>After setting the bits of the inputs that are high (and stable), we should also clear the inputs which are low (and stable). This is performed by the following statement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">asserted</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">prev_state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">current_state</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>We use the bitwise or operator <code class="code docutils literal notranslate"><span class="pre">|</span></code> to make sure that only the bits which are zero in both the current, and previous state will be asserted as low.</p>
<p>Further down we update the history in preparation for the next time the function is called:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">prev_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_state</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Finally we use the bitwise exclusive or operation <code class="code docutils literal notranslate"><span class="pre">^</span></code> between the currently asserted button states, and the previously asserted button states. This has the effect that only the bits that are different (the buttons which have changed state) remains high in <code class="code docutils literal notranslate"><span class="pre">btn_asserted_prev</span></code>. By checking the states of these bits, we can then determine if a button has changed state or not.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">asserted</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>This variable is then used to detect the state change of a given input (0x04 = 0b100), input 3 in this example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">btn_asserted_prev</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x04</span><span class="p">){</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loops">
<h2>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h2>
<p>Loops are the mechanism by which our software is able to perform repetitive tasks. We have already been using a loop, our <code class="code docutils literal notranslate"><span class="pre">loop()</span></code> function. This loop is known as an infinite loop, as there is no condition in our software which will make it stop. Ofc it will stop if you reset your controller, or remove the power supply, but such conditions are outside the control of our software. Infinite loops are useful in application which should be performing some operation constantly, e.g. in order to be responsive to external events.</p>
<p>For many applications however it is useful to have a loop which only execute the same code a limited number of times. This could be a given fixed number of times, or there could be some condition which will make the loop stop.</p>
<div class="section" id="while-loops">
<h3>While loops<a class="headerlink" href="#while-loops" title="Permalink to this headline">¶</a></h3>
<p>The while loop executes as long as the condition inside the parentheses is true.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="p">(</span><span class="n">condition</span><span class="p">){</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="for-loops">
<h3>For loops<a class="headerlink" href="#for-loops" title="Permalink to this headline">¶</a></h3>
<p>The for loop execute as long as a condition is true, but unlike the while loop it has a slightly more organized structure for counting. There is nothing the for loop can do, which the while loop can not do, but it can make your code more clean.</p>
<p>The following example illustrates the use of the for loop for executing the same code 10 times.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add code to execute here</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you want to use a while loop to perform the same task, you would have to write:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add code to execute here</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In the for loop the counter variable <code class="code docutils literal notranslate"><span class="pre">i</span></code> is updated after the code inside the loop is executed, hence if the counter variable is used by the code and you want the exact same operation as the for loop example, you must do the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add code to execute here</span>
<span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>That is you must place the code that you are going to add above the increment of the counter (in the above code only the comment is moved).</p>
</div>
<div class="section" id="do-while-loops">
<h3>Do while loops<a class="headerlink" href="#do-while-loops" title="Permalink to this headline">¶</a></h3>
<p>The do while loop is likely the least commonly used of the three types we discuss here. The difference between while, and do while, is that the latter is executed at least once. Again there is nothing preventing you from achieving the same result by using while, or for loops, but in some situations the do while loop will produce the most clean code.</p>
<p>For our count to 10 example we can do:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add code to execute here</span>
<span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="loop-example">
<h3>Loop example<a class="headerlink" href="#loop-example" title="Permalink to this headline">¶</a></h3>
<p>The following code listing demonstrate the three loop types discussed in the previous sections. As a bonus a fourth loop type based on the <code class="code docutils literal notranslate"><span class="pre">goto</span></code> keyword is also demonstrated, but this type is rarely used in practice.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kt">void</span><span class="w"> </span><span class="nf">while_loop_test</span><span class="p">(){</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;While loop: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="linenos">11</span><span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">12</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">13</span><span class="p">}</span><span class="w"></span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="kt">void</span><span class="w"> </span><span class="nf">for_loop_test</span><span class="p">(){</span><span class="w"></span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">18</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">19</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;For loop: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">20</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="linenos">21</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">22</span><span class="p">}</span><span class="w"></span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="kt">void</span><span class="w"> </span><span class="nf">do_while_loop_test</span><span class="p">(){</span><span class="w"></span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">29</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Do while loop: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">30</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="linenos">31</span><span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">32</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="linenos">33</span><span class="p">}</span><span class="w"></span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="cm">/**</span>
<span class="linenos">36</span><span class="cm"> * Note: unless you are absolutely sure that it is the right choice it is better to avoid the goto/label approach.</span>
<span class="linenos">37</span><span class="cm"> * It is somtimes used for error handling, but rarely a good choice for loops.</span>
<span class="linenos">38</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">39</span><span class="kt">void</span><span class="w"> </span><span class="nf">goto_loop_test</span><span class="p">(){</span><span class="w"></span>
<span class="linenos">40</span><span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="w">  </span><span class="nl">loop_label</span><span class="p">:</span><span class="w"></span>
<span class="linenos">43</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;goto loop: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">44</span><span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="linenos">45</span><span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">46</span><span class="w">  </span>
<span class="linenos">47</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">){</span><span class="w"></span>
<span class="linenos">48</span><span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">loop_label</span><span class="p">;</span><span class="w"></span>
<span class="linenos">49</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">50</span><span class="p">}</span><span class="w"></span>
<span class="linenos">51</span>
<span class="linenos">52</span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">53</span><span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="linenos">54</span><span class="p">}</span><span class="w"></span>
<span class="linenos">55</span>
<span class="linenos">56</span><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="w">  </span><span class="n">while_loop_test</span><span class="p">();</span><span class="w"></span>
<span class="linenos">59</span><span class="w">  </span><span class="n">for_loop_test</span><span class="p">();</span><span class="w"></span>
<span class="linenos">60</span><span class="w">  </span><span class="n">do_while_loop_test</span><span class="p">();</span><span class="w"></span>
<span class="linenos">61</span><span class="w">  </span><span class="n">goto_loop_test</span><span class="p">();</span><span class="w"></span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span><span class="w"></span>
<span class="linenos">64</span><span class="p">}</span><span class="w"></span>
<span class="linenos">65</span>
</pre></div>
</div>
</div>
<div class="section" id="exercise-blink-a-led-seven-times">
<h3>Exercise: Blink a LED seven times<a class="headerlink" href="#exercise-blink-a-led-seven-times" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Write a loop which blinks a LED seven times and then stop. The loop should be placed in a separate function, which is called from <code class="code docutils literal notranslate"><span class="pre">setup()</span></code>. A count down should be printed to the serial port.</p></li>
<li><p>Extend the program to allow initiating the blinking by pushing a button. This time the function should be called from <code class="code docutils literal notranslate"><span class="pre">loop()</span></code>.</p></li>
</ol>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">ELE102 Microcontroller course v1.1.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="L3_digital_io_and_timing.html" title="Digital I/O, and timing" >previous</a></li>
        <li><a href="../Lessons-additional/L1_additional.html" title="Additional material for lesson 1" >next</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2022, Gizem Ateş &amp; Eirik Haustveit.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.4.0.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>