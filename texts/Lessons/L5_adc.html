<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Analog to digital conversion (ADC) &mdash; ELE102 Microcontroller course v1.1.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     'v1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="ELE102 Microcontroller course v1.1.0 documentation" href="../../index.html" />
    <link rel="next" title="Additional material for lesson 1" href="../Lessons-additional/L1_additional.html" />
    <link rel="prev" title="Analog output (digital to analog conversion)" href="L4_dac_pwm.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">ELE102 Microcontroller course v1.1.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Analog to digital conversion (ADC)</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#analog-to-digital-converter">Analog to digital converter</a></li>
<li><a class="reference internal" href="#successive-approximation-sar-adc">Successive Approximation (SAR) ADC.</a></li>
<li><a class="reference internal" href="#important-parameters-for-adc-operation">Important parameters for ADC operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-adc-in-arduino">Using the ADC in Arduino</a><ul>
<li><a class="reference internal" href="#exercise-print-raw-adc-value-to-serial-port">Exercise: print raw ADC value to serial port</a></li>
<li><a class="reference internal" href="#example-temperature-measurement-using-tmp36">Example: Temperature measurement using TMP36</a></li>
<li><a class="reference internal" href="#exercise-change-the-unit-of-temperature-measurement">Exercise: Change the unit of temperature measurement</a></li>
<li><a class="reference internal" href="#example-potentiometer-as-analog-input">Example: Potentiometer as Analog Input</a></li>
<li><a class="reference internal" href="#exercise-potentiometer-adjustable-blink-rate">Exercise: Potentiometer adjustable blink rate</a></li>
<li><a class="reference internal" href="#exercise-temperature-alarm-challenging">Exercise: Temperature alarm (challenging)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detailed-look-at-the-atmega328p-adc">Detailed look at the Atmega328p ADC</a><ul>
<li><a class="reference internal" href="#voltage-reference-for-the-adc">Voltage reference for the ADC</a></li>
<li><a class="reference internal" href="#adc-conversion-speed">ADC conversion speed</a></li>
<li><a class="reference internal" href="#low-level-control-of-the-analog-to-digital-conversion">Low level control of the Analog to Digital Conversion</a></li>
<li><a class="reference internal" href="#increasing-resolution-by-oversampling">Increasing resolution by oversampling</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="L4_dac_pwm.html" title="Analog output (digital to analog conversion)" accesskey="P">previous </a></li>
              <li><a href="../Lessons-additional/L1_additional.html" title="Additional material for lesson 1" accesskey="N">next </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<h3><a href="../../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Lessons:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="L0_Introduction_elk.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_hardware_preparations.html">Software and hardware preparations</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1a_UC_intro.html">Lesson 1a: What is a Microcontroller</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1b_Arduino_intro.html">Lesson 1b: Introduction to Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_digital_io.html">Lesson 2: Digital I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="L3_digital_io_and_timing.html">Lesson 3: Use of digital I/O and timing</a></li>
<li class="toctree-l1"><a class="reference internal" href="L4_dac_pwm.html">Lesson 4: Analog output (PWM)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lesson 5: Analog to digital conversion (ADC)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#analog-to-digital-converter">Analog to digital converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#successive-approximation-sar-adc">Successive Approximation (SAR) ADC.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#important-parameters-for-adc-operation">Important parameters for ADC operation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-adc-in-arduino">Using the ADC in Arduino</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exercise-print-raw-adc-value-to-serial-port">Exercise: print raw ADC value to serial port</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-temperature-measurement-using-tmp36">Example: Temperature measurement using TMP36</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-change-the-unit-of-temperature-measurement">Exercise: Change the unit of temperature measurement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-potentiometer-as-analog-input">Example: Potentiometer as Analog Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-potentiometer-adjustable-blink-rate">Exercise: Potentiometer adjustable blink rate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-temperature-alarm-challenging">Exercise: Temperature alarm (challenging)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#detailed-look-at-the-atmega328p-adc">Detailed look at the Atmega328p ADC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#voltage-reference-for-the-adc">Voltage reference for the ADC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adc-conversion-speed">ADC conversion speed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#low-level-control-of-the-analog-to-digital-conversion">Low level control of the Analog to Digital Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#increasing-resolution-by-oversampling">Increasing resolution by oversampling</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional material:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L1_additional.html">Additional material lesson 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L2_additional.html">Additional material lesson 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L3_additional.html">Additional material lesson 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L4_additional.html">Additional material lesson 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lessons-additional/L5_additional.html">Additional material lesson 5</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/Additionals.html">Mix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/ir_communication.html">Infrared remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/RC_car.html">Cool Project: RC Car (Bluetooth or Joystick)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Projects/Robotarm.html">Cool Project: Simple Robot Arm (Bluetooth or Joystick)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/low_power_operation.html">Low power operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/stacks_queues_lists.html">Lesson Stacks, Queues, Lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/assembly_programming.html">Assembly programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendices/digital_filters.html">Digital filters</a></li>
</ul>

<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="L4_dac_pwm.html"
                          title="previous chapter">Analog output (digital to analog conversion)</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../Lessons-additional/L1_additional.html"
                          title="next chapter">Additional material for lesson 1</a></p>
  </div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="analog-to-digital-conversion-adc">
<span id="analog-to-digital-conversion"></span><h1>Analog to digital conversion (ADC)<a class="headerlink" href="#analog-to-digital-conversion-adc" title="Permalink to this headline">¶</a></h1>
<p>In the previous lesson we discussed digital to analog conversion. In this lesson we consider the opposite process, where a analog signal is converted in to a digital representation.</p>
<p>In order to be prepared for all the exercises in this lesson, the following connections should be made in advance:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/arduino_pb_led_pot_tmp36_bb.png"><img alt="Arduino with external LED, push buttons, potentiometer, and TMP32 temperature sensor." src="../../_images/arduino_pb_led_pot_tmp36_bb.png" style="width: 511.5px; height: 661.5px;" /></a>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Analog to digital converters (ADC) and digital to analog converters (DAC) are
the bridges between digital and analog worlds.</p>
<p>The analog to digital converter has many applications, some of which include:</p>
<ul class="simple">
<li><p>Reading of potentiometer settings</p></li>
<li><p>Reading of temperature sensors, pressure sensors, light sensors, strain sensors, etc.</p></li>
<li><p>Reading the voltage on a battery in order to determine the state of charge (sometimes combined with a temperature reading, since battery voltage can be affected by temperature)</p></li>
<li><p>Measurement of EMF in order to determine the rotational speed of a motor</p></li>
<li><p>Measurement of voltage and current in power systems in order to calculate active (P), and reactive (Q) power.</p></li>
<li><p>Reception of radio signals for use in a software defined radio (SDR)</p></li>
</ul>
<div class="section" id="analog-to-digital-converter">
<h3>Analog to digital converter<a class="headerlink" href="#analog-to-digital-converter" title="Permalink to this headline">¶</a></h3>
<p>An A/D converter (analog to digital converter) is a device that converts a analog signal into an approximate digital representation. Many different technologies exits for this purpose, where each one has it’s own advantages and disadvantages. The following is a list of the more common types:</p>
<ul class="simple">
<li><p>Successive Approximation (SAR) ADC.</p></li>
<li><p>Delta-sigma (ΔΣ) ADC.</p></li>
<li><p>Dual Slope ADC.</p></li>
<li><p>Pipelined ADC.</p></li>
<li><p>Flash ADC</p></li>
</ul>
<p>The Atmega328p of the Arduino UNO has a successive approximation ADC, and the operation of this type of converter will be discussed briefly. The other types will not be discussed further in this lecture.</p>
</div>
<div class="section" id="successive-approximation-sar-adc">
<h3>Successive Approximation (SAR) ADC.<a class="headerlink" href="#successive-approximation-sar-adc" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<img alt="../../_images/sar_block_diagram.png" src="../../_images/sar_block_diagram.png" />
</div>
<p>The successive approximation ADC uses a binary search method to go through all possible quantization levels for the digital representation for the analog value, until it finally reaches the best approximation.</p>
<p>The analog value is sampled, and a constant voltage sample is held in the sample and hold (S/H) circuit. This voltage sample is then compared to the output voltage from a digital to analog converter (DAC), which initially is set to zero volts. The comparator then informs the successive approximation register whether the sampled voltage is above or below the DAC output. If the sampled voltage is higher than the DAC output, the successive approximation register increase the DAC output on the next clock cycle. This process continues on each clock cycle until the DAC output becomes higher than the sampled value.</p>
<p>The digital signal which is required to control the DAC in such a way that it outputs a voltage approximately equal to the sampled voltage, is then used as the digital representation of this analog voltage. The end of conversion (EOC) signal informs the processor that the conversion process is completed.</p>
<p>It should be obvious from the above explanation that the analog to digital converter needs some time to complete the conversion process. The time it takes to complete one conversion is one of the fundamental parameters describing an ADC.</p>
</div>
<div class="section" id="important-parameters-for-adc-operation">
<h3>Important parameters for ADC operation<a class="headerlink" href="#important-parameters-for-adc-operation" title="Permalink to this headline">¶</a></h3>
<p>There are many important parameters one should understand when applying an A/D converter. Even if a particular ADC is selected, there are still many parameters that can be adjusted within the ADC depending on how you intend to use it. The following is a summary of a few basic ones:</p>
<ul class="simple">
<li><p>Resolution - The digital representation of the analog signal must use a finite number of bits, and this imposes limitations on the smallest possible change in the analog value that is detectable by the converter.</p></li>
<li><p>Sampling frequency - The conversion from analog to digital takes up a finite time, and this imposes limitation on how fast changes in the analog signals that are detectable.</p></li>
<li><p><a class="reference external" href="https://jeelabs.org/article/1620b">Aliasing</a> - If the measured analog signal contains components with a frequency that is higher than half of the sampling frequency, there is a risk of aliasing. The risk is that the resulting digital representation contains frequency components that does not exist in the real analog signal.</p></li>
<li><p>Dymaic range -  The range of signal amplitudes that the ADC can resolve.</p></li>
</ul>
<p>For simple applications with values that vary slowly (e.g. temperature measurements), it might be sufficient to only take these parameters into account. For more demanding applications (e.g. real time current measurements in a motor drive), one should obtain a deeper knowledge of all the parameters that will impact the performance.</p>
<p>The analog input or output range is determined by a reference voltage, <span class="math notranslate nohighlight">\(V_{ref}\)</span>. Typically for an N-bit converter with
unsigned digital I/O and unipolar analog range <span class="math notranslate nohighlight">\((0V .. +V_{ref})\)</span>, one step at the analog
end, <span class="math notranslate nohighlight">\(\Delta V_{LSB}\)</span>, is given by:</p>
<div class="math notranslate nohighlight">
\[\Delta V_{LSB} = \frac{V_{ref}}{2^N}\]</div>
<p>Similarly for a bipolar analog range <span class="math notranslate nohighlight">\((-V_{ref} .. +V_{ref})\)</span>, one step at the analog end is:</p>
<div class="math notranslate nohighlight">
\[\Delta V_{LSB} = \frac{V_{ref}}{2^N}\]</div>
</div>
</div>
<div class="section" id="using-the-adc-in-arduino">
<h2>Using the ADC in Arduino<a class="headerlink" href="#using-the-adc-in-arduino" title="Permalink to this headline">¶</a></h2>
<p>The Arduino UNO has six analog inputs on the pins A0 to A5. There is only a single ADC, but some internal switches allows us to select which of the inputs is sampled. By default the voltage range on each input is 0 - 5 V.</p>
<p>In the Arduino library the function <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code> can be used to read data from the ADC. E.g. <code class="code docutils literal notranslate"><span class="pre">analogRead(A0)</span></code> in order to read the first analog input. This is a blocking function, meaning the program will stop and wait for the conversion process to complete before the function returns. The ADC has a resolution of 10 bit, which means that the value returned from <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code> will be a number between 0, and 1023. There is no 10 bit datatype, and in the function declaration the return type is set to <code class="code docutils literal notranslate"><span class="pre">int</span></code>, which is a 16 bit signed number on the Arduino UNO. In reality it can never be negative, and thus a unsigned int, or <code class="code docutils literal notranslate"><span class="pre">uint16_t</span></code> could have been used.</p>
<p>The ADC will convert the analog input voltage (0 - 5 V) in to a number (0 - 1023). If you are interested in knowing the voltage level, some basic calculations has to be performed after the conversion is completed.</p>
<p>If the number returned from <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code> is 400, the voltage is given by:</p>
<div class="math notranslate nohighlight">
\[V = \frac{400}{1023} \cdot 5 = 1.955 V\]</div>
<p>You should also consider how many significant figures you can have in this number. I.e. how many volts do you have per bit.</p>
<div class="math notranslate nohighlight">
\[\frac{5 V}{1023} = 4.888 mV/bit\]</div>
<p>The conversion time is approximately 100 microseconds, which means that it is possible to perform 10000 conversions each second. This is not the absolute maximum speed of the ADC, it is simply how the ADC is configured inside the Arduino library.</p>
<div class="section" id="exercise-print-raw-adc-value-to-serial-port">
<h3>Exercise: print raw ADC value to serial port<a class="headerlink" href="#exercise-print-raw-adc-value-to-serial-port" title="Permalink to this headline">¶</a></h3>
<p>In this exercise you will experience how various voltages applied to analog input A0 affects the value returned from <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code>.</p>
<ol class="arabic simple">
<li><p>Write a simple program that is able to print a message to the serial port at a given interval. Use <code class="code docutils literal notranslate"><span class="pre">millis()</span></code> to obtain the delay, and use a interval of 2 seconds.</p></li>
<li><p>Extend the program so that the value printed to the serial port is the raw value returned from <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code>.</p></li>
<li><p>Test the program by applying various voltages to the A0 port. Try 5 V, 3.3 V, GND, and optionally a resistive voltage divider using two resistors.</p></li>
</ol>
</div>
<div class="section" id="example-temperature-measurement-using-tmp36">
<h3>Example: Temperature measurement using TMP36<a class="headerlink" href="#example-temperature-measurement-using-tmp36" title="Permalink to this headline">¶</a></h3>
<p>In this example we will be reading the temperature from the TMP36 sensor that is included in the Arduino kit. The TMP36 has a voltage output linearly proportional to the temperature, and thus makes it easy to measure temperatures without any curve fitting that must be used with nonlinear sensing elements.</p>
<p>The details of how the TMP36 operates are available in the <a class="reference external" href="https://www.analog.com/media/en/technical-documentation/data-sheets/TMP35_36_37.pdf/">datasheet</a></p>
<p>Connect the sensor according to the following diagram:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/temperature_sensor_bb.png"><img alt="../../_images/temperature_sensor_bb.png" src="../../_images/temperature_sensor_bb.png" style="width: 484.5px; height: 660.0px;" /></a>
</div>
<p>The following source code listing shows how to read the sensor, and how to convert the raw reading to voltage, and temperature:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Try to change the program to use <code class="code docutils literal notranslate"><span class="pre">millis()</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">delay()</span></code>.</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sensorVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">sensorVolt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sensorVal</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sensorVolt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Sensor verdi: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorVal</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Sensor spenning: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorVolt</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Sensor temperatur: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="exercise-change-the-unit-of-temperature-measurement">
<h3>Exercise: Change the unit of temperature measurement<a class="headerlink" href="#exercise-change-the-unit-of-temperature-measurement" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Use the program in the previous example as basis, and add the code required to print the temperature in Kelvin to the serial port.</p></li>
<li><p>Extend the program by printing the temperature in Fahrenheit, and Rankine.</p></li>
</ol>
</div>
<div class="section" id="example-potentiometer-as-analog-input">
<h3>Example: Potentiometer as Analog Input<a class="headerlink" href="#example-potentiometer-as-analog-input" title="Permalink to this headline">¶</a></h3>
<p>A potentiometer is a type of variable resistor with 3 connections. Two of the connections are placed at the extreme ends of the resistor, for ease of discussion we will name them connector (1), and (2). I.e. the resistance between pins (1), and (2) is always equal to the maximum resistance of the variable resistor. The third connector (3) is connected to a sliding contact, which moves along the resistor. At one extreme end this sliding connector is at (or close to) connector (1), at the other extreme it is at connector (2).</p>
<p>By applying a fixed voltage between connector (1), and (2), the voltage at the sliding contact (3) will vary linearly with the rotation of the potentiometer knob.</p>
<div class="figure align-center">
<img alt="Simple potentiometer circuit" src="../../_images/simple_pot_battery.png" />
</div>
<p>You can use this potentiometer value for various different purposes. Now, assume that your microcontroller team is assigned to develop a simple heat display system. If the temperature is higher than 30 celcius, the display gives a warning. If it is between 20-30 celcius, everything is fine. If it is less than 20 celcius, then your display system warns again. To have a temperature sensor (in real life) and physically change the temperature of the room for the sake of test is not very efficient. <em>We all know</em> that temperature sensor gives an analog signal so I can test the system using a potentiometer to emulate the sensor.</p>
<p>For this example you should use the following circuit:</p>
<div class="figure align-center">
<img alt="Simple potentiometer circuit with Arduino" src="../../_images/simple_pot_arduino.png" />
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sensorVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">sensorVolt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sensorVal</span><span class="o">/</span><span class="mf">1024.0</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sensorVolt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Raw value: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorVal</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Voltage: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorVolt</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Temperature: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Warm&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">temperature</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">20</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">30</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;:)&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Cold&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After you have finished testing the software using a potentiometer to emulate the temperature sensor, you should connect a real temperature sensor for the final test. There is always a risk that there is something you did not take in to account when performing the emulated test.</p>
</div>
</div>
<div class="section" id="exercise-potentiometer-adjustable-blink-rate">
<h3>Exercise: Potentiometer adjustable blink rate<a class="headerlink" href="#exercise-potentiometer-adjustable-blink-rate" title="Permalink to this headline">¶</a></h3>
<p>In this exercise you will develop a program which allows adjusting the blink rate (frequency) of a LED by means of a potentiometer.</p>
<ol class="arabic simple">
<li><p>Write a program which blinks a LED using <code class="code docutils literal notranslate"><span class="pre">millis()</span></code> for the delay.</p></li>
<li><p>Connect a potentiometer to input A0, and add the code required to sample the potentiometer value at a rate of 10 milliseconds.</p></li>
<li><p>Use the potentiometer value to control the blink frequency of the LED. The minimum setting should be 0.5 Hz, and maximum should be 25 Hz.</p></li>
</ol>
</div>
<div class="section" id="exercise-temperature-alarm-challenging">
<h3>Exercise: Temperature alarm (challenging)<a class="headerlink" href="#exercise-temperature-alarm-challenging" title="Permalink to this headline">¶</a></h3>
<p>In this exercise you will expand the temperature reading example in to a program that generates a alarm signal if the temperature exceeds a level of 27 degrees. The temperature alarm limit is set to this value so that it will be easy to test, it is above the typical room temperature, but below the body temperature (or the temperature of your coffee).</p>
<ol class="arabic simple">
<li><p>Start by connecting the TMP36, as well as a push button, and a red LED to the Arduino.</p></li>
<li><p>Write a program which continuously reads the temperature value, and compares it to a alarm limit defined by a constant variable. Use <code class="code docutils literal notranslate"><span class="pre">millis()</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">delay()</span></code> for delaying the execution time for the sampling. Use a interval of 1 second. For easy debugging the actual temperature value should be printed to the serial terminal at each sampling interval.</p></li>
<li><p>Extend the program with the code required to initiate blinking of the LED, and printing of the text “Temperature alarm!” to the serial port as soon as the temperature exceeds the limit. The alarm should not stop, even if the temperature goes back down again below the alarm limit.</p></li>
<li><p>Add an alarm acknowledge push button function. If the button is pushed, and the temperature is below the alarm limit, the LED blink, and alarm message should go away. For this functionality debouncing is not needed, as acknowledging an already acknowledged alarm will not perform any action.</p></li>
</ol>
</div>
</div>
<div class="section" id="detailed-look-at-the-atmega328p-adc">
<h2>Detailed look at the Atmega328p ADC<a class="headerlink" href="#detailed-look-at-the-atmega328p-adc" title="Permalink to this headline">¶</a></h2>
<p>In the ADC hardware of the Atmega328p, there are many different parameters that needs to be configured properly. For example setting the ADC speed, resolution, conversion mode etc. By using the <code class="code docutils literal notranslate"><span class="pre">analogRead(analogPin)</span></code> Arduino function without changing anything, we simply accept the parameters that the Arduino developers hav selected for us. The default settings are fine for basic usage, but there are many situations where you would have to go in to the details.</p>
<div class="section" id="voltage-reference-for-the-adc">
<h3>Voltage reference for the ADC<a class="headerlink" href="#voltage-reference-for-the-adc" title="Permalink to this headline">¶</a></h3>
<p>As discussed previously, the analog to digital converter uses a voltage reference for comparison with the analog signal it is converting. The Atmega328p microcontroller has several options for where to obtain this reference. In the Arduino UNO library these reference options may be set by the <code class="code docutils literal notranslate"><span class="pre">analogReference()</span></code> function, which takes the parameters <cite>DEFAULT</cite>, <cite>INTERNAL</cite>, or <cite>EXTERNAL</cite>, for 5V, 1.1V or externally applied voltage to the AREF-pin respectively. The selected reference voltage will be the maximum input voltage for the ADC, i.e. the voltage that will correspond to the digital value of 1023.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">analogReference</span><span class="p">(</span><span class="n">EXTERNAL</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>If you are only interested in measuring voltages from 0 - 2 V, a external reference of 2 V will provide better resolution than the default reference of 5 V.</p>
<p>The accuracy of the reference voltage directly affects the accuracy of the converted voltage, and this is another motive for using an external reference. By accuracy in this context we mean: how sure can you be that the voltage actually is 5 V, is it 5.00 V, or could it be 5.02 V? A highly precise reference voltage can be used if high accuracy is required.</p>
</div>
<div class="section" id="adc-conversion-speed">
<h3>ADC conversion speed<a class="headerlink" href="#adc-conversion-speed" title="Permalink to this headline">¶</a></h3>
<p>The conversion speed is determined by the clock signal to the successive approximation register in the ADC. There is a maximum limit to this clock, after which the ADC starts misbehaving. The recommended maximum clock speed is 200 kHz, while the specified absolute maximum speed is 1 Mhz.</p>
<p>In the Arduino library the clock is derived from the CPU clock by using a prescaler of 128</p>
<div class="math notranslate nohighlight">
\[\frac{16 Mhz}{128} = 125 kHz\]</div>
<p>Each conversion takes 13 ADC clock cycles, which yields a sample rate of:</p>
<div class="math notranslate nohighlight">
\[\frac{125 kHz}{13} = 9615 Hz\]</div>
<p>The conversion time is thus given by:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{9615} = 104 us\]</div>
<p>This corresponds well with the conversion time stated in the documentation for the <code class="code docutils literal notranslate"><span class="pre">analogRead()</span></code> function in the Arduino library.</p>
</div>
<div class="section" id="low-level-control-of-the-analog-to-digital-conversion">
<h3>Low level control of the Analog to Digital Conversion<a class="headerlink" href="#low-level-control-of-the-analog-to-digital-conversion" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of the implementation of ADC without using built-in <code class="code docutils literal notranslate"><span class="pre">analogRead(analogPin)</span></code> function. There are different ways of bitwise operations. It is better to be consistent in using one way but here we would like to see different ways. Let’s understand it with the help of Atmega328p datasheet.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>

<span class="cp">#define BAUDRATE 9600</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">init_ports</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">init_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="nf">read_ADC</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">);</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">init_adc</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">BAUDRATE</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">adc_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adc_read</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;ADC value:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">adc_val</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">init_adc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ADMUX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">REFS0</span><span class="p">);</span><span class="w"> </span><span class="c1">//default Ch-0; Vref = 5V</span>
<span class="w">  </span><span class="c1">//ADMUX = ADMUX | 0x20;   // set for Left Justified</span>
<span class="w">  </span><span class="n">ADCSRA</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ADEN</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ADSC</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ADATE</span><span class="p">);</span><span class="w"> </span><span class="c1">//auto-trigger OFF -- EXERCISE:how to write in hexadecimal?</span>
<span class="w">  </span><span class="n">ADCSRB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">uint16_t</span><span class="w"> </span><span class="nf">adc_read</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pin</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">     </span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// select the corresponding channel 0~7</span>
<span class="w">  </span><span class="c1">// ANDing with &#39;7′ will always keep the value of pin between 0 and 7</span>
<span class="w">  </span><span class="n">pin</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="mb">0b00000111</span><span class="p">;</span><span class="w">  </span><span class="c1">// AND operation with 7 // pin &amp;= 0x07 // pin = pin &amp; 7</span>
<span class="w">  </span><span class="n">ADMUX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ADMUX</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xF8</span><span class="p">)</span><span class="o">|</span><span class="n">pin</span><span class="p">;</span><span class="w"> </span><span class="c1">// setting MUX[0:3]</span>

<span class="w">  </span><span class="c1">// start single convertion</span>
<span class="w">  </span><span class="n">ADCSRA</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ADSC</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// wait for conversion to complete</span>
<span class="w">  </span><span class="c1">// ADSC becomes &#39;0′ again</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">ADCSRA</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x10</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// until the flag is reset again // while(ADCSRA &amp; (1 &lt;&lt; ADSC))</span>
<span class="w">  </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ADCL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">ADCH</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span><span class="w"> </span><span class="c1">//10-bit data</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ADC is a demanding topic also requires basic signal processing knowledge. One should read about possible errors before computing a serious analog to digital conversion. <a class="reference external" href="https://www.maximintegrated.com/en/design/technical-documents/tutorials/6/641.html">Here,</a> is a very nice summary of general ADC problems.</p>
</div>
<p>While the main function of the analog pins for most Arduino users is to read analog sensors, the analog pins also have all the functionality of general purpose input/output (GPIO) pins (the same as digital pins 0 - 13). Consequently, if a user needs more general purpose input output pins, and all the analog pins are not in use, the analog pins may be used for GPIO.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The analogRead function will not work correctly if a pin has been previously set to an output, so if this is the case, set it back to an input before using analogRead. Similarly if the pin has been set to HIGH as an output, the pull-up resistor will be set, when switched back to an input.</p>
<p>The ATmega datasheet also cautions against switching analog pins in close temporal proximity to making A/D readings (analogRead) on other analog pins. This can cause electrical noise and introduce jitter in the analog system. It may be desirable, after manipulating analog pins (in digital mode), to add a short delay before using analogRead() to read other analog pins.</p>
</div>
</div>
<div class="section" id="increasing-resolution-by-oversampling">
<h3>Increasing resolution by oversampling<a class="headerlink" href="#increasing-resolution-by-oversampling" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Explain how to use oversampling (and why it works)</p>
</div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">ELE102 Microcontroller course v1.1.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="L4_dac_pwm.html" title="Analog output (digital to analog conversion)" >previous</a></li>
        <li><a href="../Lessons-additional/L1_additional.html" title="Additional material for lesson 1" >next</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2022, Gizem Ateş &amp; Eirik Haustveit.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.4.0.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>